import 'package:flutter_test/flutter_test.dart';
import 'package:boring_flutter_dev/src/articles.dart';
import 'package:http/http.dart' as http;

void main() {
  test("Parse HN Top Stories JSON", () {
    const json =
        "[22857551,22856199,22857082,22856324,22854332,22855407,22857105,22845068,22854485,22850195,22854120,22857004,22854272,22854022,22850488,22855122,22846241,22843225,22858168,22857384,22855633,22858122,22858235,22857318,22856030,22855357,22856717,22854303,22854475,22842547,22848423,22854308,22839577,22858154,22852646,22854693,22853920,22854204,22843306,22844009,22852316,22850817,22855070,22858035,22854522,22852375,22849208,22852982,22854218,22852125,22857177,22842062,22848034,22858012,22855664,22854209,22848106,22840150,22847491,22848296,22855610,22850386,22856260,22846435,22854393,22852484,22845629,22846296,22848450,22848766,22851622,22857623,22846250,22858918,22853497,22854045,22855559,22856703,22842542,22850657,22855362,22858335,22853443,22850025,22854143,22841269,22855755,22847462,22842774,22839627,22844458,22847799,22832410,22855286,22844196,22848192,22850976,22853804,22840413,22850004,22849554,22854265,22832884,22853604,22845249,22846782,22855340,22843493,22853921,22843140,22834058,22843085,22847877,22848137,22857232,22834524,22845668,22837990,22850723,22852498,22848216,22848721,22850374,22850791,22849081,22847092,22841857,22840034,22842016,22853605,22844118,22846586,22843919,22839943,22851323,22849250,22855433,22849172,22851167,22844820,22854562,22847547,22846688,22831323,22842383,22857531,22849747,22851781,22844907,22840728,22847077,22840211,22845518,22846414,22845373,22841601,22841164,22855940,22841171,22849538,22839035,22847079,22846811,22843908,22850594,22855195,22836698,22845733,22844520,22847429,22849264,22841708,22855950,22848861,22843705,22843964,22837301,22834286,22847164,22846693,22838119,22844597,22844223,22841847,22856910,22833601,22846787,22852942,22852022,22831715,22832627,22842190,22837036,22844260,22834959,22854302,22851772,22851870,22838255,22851640,22839603,22838130,22854710,22852675,22855600,22843326,22854172,22843097,22851314,22857365,22839012,22844685,22844723,22838466,22840295,22837356,22843691,22841422,22834901,22838970,22841022,22850994,22839583,22840867,22853102,22850977,22848598,22840869,22839563,22836685,22834548,22842905,22839063,22831931,22837697,22838430,22832440,22838576,22836940,22843533,22850972,22846851,22842521,22842338,22842281,22850053,22848584,22849878,22841232,22842847,22832660,22842442,22843068,22838207,22847089,22840164,22842921,22836883,22853900,22841336,22843823,22836272,22846858,22838995,22840355,22846219,22844552,22841464,22844788,22831604,22840600,22851657,22847311,22845765,22841090,22853570,22855459,22847096,22846086,22846596,22849640,22847116,22849400,22855022,22839561,22837753,22841071,22842110,22846283,22840057,22844343,22834422,22849892,22849138,22833429,22852171,22831506,22854745,22836787,22851485,22848099,22834965,22857491,22852844,22846235,22844099,22851561,22838417,22845819,22833455,22841354,22838440,22853197,22847984,22851121,22845667,22842126,22837313,22839247,22831567,22841119,22850083,22832914,22846408,22846670,22845239,22831789,22832364,22844029,22843911,22847332,22834053,22846094,22847814,22838727,22835136,22833304,22848055,22849456,22832515,22837807,22846666,22846195,22852894,22835443,22846262,22852798,22841175,22832848,22848396,22841436,22831525,22842993,22833189,22841098,22847342,22850132,22845389,22846716,22840738,22839089,22831597,22844975,22836579,22838770,22840197,22836125,22848097,22835566,22835089,22834575,22852693,22845152,22844949,22840476,22843204,22832192,22856581,22832960,22837091,22846604,22848160,22841877,22849290,22848063,22843411,22838532,22836027,22846353,22832955,22845293,22851860,22838251,22848948,22833216,22842693,22840653,22837497,22846410,22849462,22846222,22837687,22842724,22849166,22851003,22847128,22841426,22843430,22839213,22841393,22838885,22848138,22833299,22841791,22845192,22846789,22838937,22836923,22839902,22852423,22839725,22839503,22836186,22835601,22843270,22847210,22836803,22839309,22849109,22834884,22840524,22839151,22840658,22852378,22840474,22843302,22848647,22843168,22841826,22846645,22842606,22839887,22847850,22831418,22832907,22837148,22841537,22838705,22839054,22841399,22833321,22847424,22847347,22847345,22835417,22838108,22847087,22834201,22831973,22831842,22832233,22837518,22831388,22845691,22846852,22839990,22834242,22840913,22846391,22839462,22846251,22832707,22842708,22840486,22834975,22831377,22838369,22831294,22841110,22836121,22833091,22842376,22837083,22836886,22836705,22835814,22836284,22835022,22841896,22844950,22834036,22833986,22834952,22841463,22834560,22838476,22849407,22833456,22832467,22834816]";

    expect(parseTopStories(json).first, 22857551);

  });
  test("Parse HN Item JSON", () {
    const json =
        """
        {"by":"pcr910303","descendants":56,"id":22857551,"kids":[22858254,22859281,22859278,22858315,22858897,22858222,22859318,22858990,22859030,22859002,22859246,22858968,22859326,22859103,22858912,22859062,22858840,22858833,22858098,22858630,22859095,22859225,22859152,22858816,22857919,22858234],"score":112,"time":1586797091,"title":"Malleable Systems: Software must be as easy to change as it is to use it","type":"story","url":"https://malleable.systems/"}
        """;

    expect(parseArticle(json).by, "pcr910303");

  });

  test("Parse JSON from network call to HN API", () async {
    final url = 'https://hacker-news.firebaseio.com/v0/topstories.json';
    final response = await http.get(url);
    if(response.statusCode == 200) {
      final itemIds = parseTopStories(response.body);
      if(itemIds.isNotEmpty) {
        final storyUrl = 'https://hacker-news.firebaseio.com/v0/item/${itemIds.first}.json';
        final storyResponse = await http.get(storyUrl);
        if(storyResponse.statusCode == 200) {
          expect(parseArticle(storyResponse.body), isNotNull);
        }
      }
    }
  }, skip: true);
}
